
<!DOCTYPE html>
<html>
	<head>
		<title>T800-Controller</title>
	</head>
	<body>
		<label for="commands">Choose command:</label><br>
		<select id="commands" name="commands">
		  <option value="epic_mode_1">T1 Epic Mode</option>
		  <option value="epic_mode_2">T2 Epic Mode</option>
		</select>
		<br>
		<button id="discoverBluetoothBtn">Discover T800 Device</button>
	</body>
	<script>
		const bluetoothName = 'DSD TECH';
		const bluetoothUUIDservice = '0000ffe0-0000-1000-8000-00805f9b34fb';
		const bluetoothUUIDcharacteristic = '0000ffe1-0000-1000-8000-00805f9b34fb';

		var command = "";
		var commandSelector = document.getElementById("commands").addEventListener('change', function() {;
			command = commandSelector.value;
		});
		
		
		document.getElementById("discoverBluetoothBtn").addEventListener('click', function() {
		  	navigator.bluetooth.requestDevice({
			    filters: [{
				    name: bluetoothName,
				    services: [bluetoothUUIDservice]
				  }]
			  	})
			  	.then(device => {
			    	console.log('> Requested ' + device.name + ' (' + device.id + ')');
				    // Attempts to connect to remote GATT Server.
		  			return device.gatt.connect();
			  	})
			  	.then(server => {
				  	return server.getPrimaryService(bluetoothUUIDservice);
				})
				.then(service => {
				  	return service.getCharacteristic(bluetoothUUIDcharacteristic);
				})
			  	.then(characteristic => {
					// const epicMode1 = "epic_mode_1";
					var stringArray = str2ab(command);
					return characteristic.writeValueWithoutResponse(stringArray);
				})
			  .catch(error => {
			    console.log('Argh! ' + error);
		  });
		});

		function str2ab(str) {
		  var buf = new ArrayBuffer(str.length*2); // 2 bytes for each char
		  var bufView = new Uint8Array(buf);
		  for (var i=0, strLen=str.length; i < strLen; i++) {
		    bufView[i] = str.charCodeAt(i);
		  }
		  return buf;
		}
	</script>
</html>