
<!DOCTYPE html>
<html>
	<head>
		<title>T800-Controller</title>
	</head>
	<body>
		<button id="discoverBluetoothBtn">Discover T800 Device</button>
	</body>
	<script>
		const bluetoothName = 'DSD TECH';
		const bluetoothUUID = '0000ffe0-0000-1000-8000-00805f9b34fb';
		
		document.getElementById("discoverBluetoothBtn").addEventListener('click', function() {
		  	navigator.bluetooth.requestDevice({
			    filters: [{
				    name: bluetoothName,
				    services: [bluetoothUUID]
				  }]
			  	})
			  	.then(device => {
			    	console.log('> Requested ' + device.name + ' (' + device.id + ')');
				    // Attempts to connect to remote GATT Server.
		  			return device.gatt.connect();
			  	})
			  	.then(server => {
				  	return server.getPrimaryService(bluetoothUUID);
				})
				.then(service => {
				  	return service.getCharacteristic(bluetoothUUID);
				})
			  	.then(characteristic => {
					const epicMode1 = "epic_mode_1";
					var stringArray = str2ab(epicMode1);
					return characteristic.writeValueWithoutResponse(stringArray);
				})
			  .catch(error => {
			    console.log('Argh! ' + error);
		  });
		});

		function str2ab(str) {
		  var buf = new ArrayBuffer(str.length*2); // 2 bytes for each char
		  var bufView = new Uint8Array(buf);
		  for (var i=0, strLen=str.length; i < strLen; i++) {
		    bufView[i] = str.charCodeAt(i);
		  }
		  return buf;
		}
	</script>
</html>