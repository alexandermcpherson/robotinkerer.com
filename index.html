
<!DOCTYPE html>
<html>
	<head>
		<title>T800-Controller</title>
		<link rel="stylesheet" href="styles.css">
	</head>
	<body>
		<button id="discoverBluetoothBtn" class="button blue_button button_corners">Discover T800 Device</button><button id="diconnectBluetoothBtn" class="button blue_button button_corners">Disconnect</button><button id="reconnectBluetoothBtn" class="button blue_button button_corners">Reconnect</button>
		<br><br>
		<h1>Lights</h1>
		<h2>Toggle Leds</h2>
		<button id="redLed1Btn" class="button red_button button_corners">Off</button><button id="redLed2Btn" class="button red_button button_corners">Off</button><br>
		<button id="blueLed1Btn" class="button blue_button button_corners">Off</button><button id="blueLed2Btn" class="button blue_button button_corners">Off</button><br>
		<button id="addRedLedBtn" class="button red_button button_corners wide_button">All Red Off</button><br>
		<button id="allBlueLedBtn" class="button blue_button button_corners wide_button">All Blue Off</button><br>
		<button id="eyeLedsBtn" class="button red_button button_corners wide_button">Eyes Off</button><br>

		<h1>Sounds</h1>
		<h1>Actions</h1>
		<label for="speech-commands">Choose Speech command:</label><br>
		<select id="speech-commands" name="speech-commands" onchange="getSpeechCommand()">
			<optgroup label = "T1">
				<option value="sc" selected="selected">Sarah Connor</option>
				<option value="fya">Fuck you asshole</option>
				<option value="ibb">Ill be back</option>
				<option value="ycgttmn">Your clothes give them to me now</option>
			  	<option value="ncr">Nothing clean right</option>
				<option value="45lswls">45 Long Slide with Lazer sighting</option>
				<option value="go">Get out</option>				
			  	<option value="u9">Uzi 9mm</option>
		  	</optgroup>
		  	<optgroup label = "T2">
		  		<option value="alvb">Asta La Vista Baby</option>
				<option value="np">No problemo</option>
				<option value="ibb">Ill be back</option>
				<option value="tm">Trust me</option>
			  	<option value="ltmvc">Listen to me very carefully</option>
				<option value="iaat">I am a Terminator</option>
				<option value="csm1">Cyberdyne systems Model 101</option>				
			  	<option value="inycybaym">I need your clothes your boots and your motorcycle</option>
				<option value="toommp">Thats one of my mission parameters</option>
				<option value="iknwyc">I now know why you cry</option>
				<option value="hl">He'll live</option>
			  	<option value="cd">Chillout dickwad</option>
				<option value="4cwmiywtl">Come with me if you want to live</option>
		  	</optgroup>
		  	<optgroup label = "T3">
		  		<option value="iaam">I am a machine</option>
				<option value="yat">You are Terminated</option>
				<option value="ddt">Don't do that</option>
			</optgroup> 
		</select>
		<p id="speechCommandSelection">You selected: Sarah Connor</p>
		<button id="sendSpeechCommandBtn">Send</button>
		<br><br>
		<label for="movement-commands">Choose Movement command:</label><br>
		<select id="movement-commands" name="movement-commands" onchange="getMovementCommand()">
			<option value="activate" selected="selected">Activate T800</option>
			<option value="deactivate">Deactivate T800</option>
			<option value="randomHeadlr">Random Head left to right</option>
			<option value="randomHeadud">Random Head up and down</option>
			<option value="randomHeadfr">Random Head full range</option>				
		  	<option value="epic_mode_1">T1 Epic Mode</option>
		  	<option value="epic_mode_2">T2 Epic Mode</option>
		</select>
		<br>
		<p id="movementCommandSelection">You selected: Activate T800</p>
		<button id="sendActionCommandBtn">Send</button>
	</body>
	<script>

		const bluetoothName = 'DSD TECH';
		const bluetoothUUIDservice = '0000ffe0-0000-1000-8000-00805f9b34fb';
		const bluetoothUUIDcharacteristic = '0000ffe1-0000-1000-8000-00805f9b34fb';

		var speechCommand = "sc";
		var movementCommand = "activate";
		var ledCommand;
		var myCharateristic;
		var bluetoothDevice;
		
		document.getElementById("discoverBluetoothBtn").addEventListener('click', function() {
			bluetoothDevice = null;
		  	navigator.bluetooth.requestDevice({
		    filters: [{
			    name: bluetoothName,
			    services: [bluetoothUUIDservice]
			  }]
		  	})
		  	.then(device => {
		  		bluetoothDevice = device;
		    	console.log('> Requested ' + device.name + ' (' + device.id + ')');
			    bluetoothDevice.addEventListener('gattserverdisconnected', onDisconnected);
			    // Attempts to connect to remote GATT Server.
	  			return device.gatt.connect();
		  	})
		  	.then(server => {
			  	return server.getPrimaryService(bluetoothUUIDservice);
			})
			.then(service => {
			  	return service.getCharacteristic(bluetoothUUIDcharacteristic);
			})
			.then(characteristic => {
				myCharateristic = characteristic;
			 })
			.catch(error => {
			    logError(error);
	  		});

		});

		// BLUETOOTH CONNECTIONS

		document.getElementById("diconnectBluetoothBtn").addEventListener('click', function() {
			disconnect();
		});

		document.getElementById("reconnectBluetoothBtn").addEventListener('click', function() {
			reconnect();
		});

		// LEDS

		document.getElementById("redLed1Btn").addEventListener('click', function() {
			sendLedCommand("red_led_1_on");
		});

		document.getElementById("redLed2Btn").addEventListener('click', function() {
			sendLedCommand("red_led_2_on");
		});

		document.getElementById("blueLed1Btn").addEventListener('click', function() {
			sendLedCommand("blue_led_1_on");
		});

		document.getElementById("blueLed2Btn").addEventListener('click', function() {
			sendLedCommand("blue_led_2_on");
		});

		document.getElementById("allBlueLedBtn").addEventListener('click', function() {
			sendLedCommand("blue_led_on");
		});

		document.getElementById("allRedLedBtn").addEventListener('click', function() {
			sendLedCommand("red_led_on");
		});

		document.getElementById("eyeLedsdBtn").addEventListener('click', function() {
			sendLedCommand("eyes_on");
		});

		// ACTION SPEECH

		document.getElementById("sendSpeechCommandBtn").addEventListener('click', function() {
			sendSpeechCommand();
		});

		// ACTION MOVEMENT

		document.getElementById("sendActionCommandBtn").addEventListener('click', function() {
			sendMovementCommand();
		});

		function connect() {
		  console.log('Connecting to Bluetooth Device...');
		  return bluetoothDevice.gatt.connect()
		  .then(server => {
		    console.log('> Bluetooth Device connected');
		  });
		}

		function disconnect() {
		  if (!bluetoothDevice) {
		    return;
		  }
		  console.log('Disconnecting from Bluetooth Device...');
		  if (bluetoothDevice.gatt.connected) {
		    bluetoothDevice.gatt.disconnect();
		  } else {
		    console.log('> Bluetooth Device is already disconnected');
		  }
		}

		function onDisconnected(event) {
		  // Object event.target is Bluetooth Device getting disconnected.
		  console.log('> Bluetooth Device disconnected');
		}

		function reconnect() {
		  if (!bluetoothDevice) {
		    return;
		  }
		  if (bluetoothDevice.gatt.connected) {
		    console.log('> Bluetooth Device is already connected');
		    return;
		  }
		  connect()
		  .catch(error => {
		    console.log('Argh! ' + error);
		  });
		}

		function sendledCommand(ledCommand) {
			logCommand(speechCommand);
			const encoder = new TextEncoder('utf-8');
  			const commandToSend = encoder.encode(speechCommand);
			myCharateristic.writeValueWithoutResponse(commandToSend);
		}

		function sendSpeechCommand() {
			logCommand(speechCommand);
			const encoder = new TextEncoder('utf-8');
  			const commandToSend = encoder.encode(speechCommand);
			myCharateristic.writeValueWithoutResponse(commandToSend);
		}

		function sendMovementCommand() {
			logCommand(movementCommand);
			const encoder = new TextEncoder('utf-8');
  			const commandToSend = encoder.encode(movementCommand);
			myCharateristic.writeValueWithoutResponse(commandToSend);
		}

		function logCommand(command) {
			console.log('Seinding command: ' + command);
		}	

		function logError(error) {
			console.log('Error: ' + error);
		}

		function getSpeechCommand() {
			const commandSelection = document.getElementById("speech-commands")
		  	command = commandSelection.value
		  	document.getElementById("speechCommandSelection").innerHTML = "You selected: " + commandSelection.options[commandSelection.selectedIndex].text;
		}

		function getMovementCommand() {
			const commandSelection = document.getElementById("movement-commands")
		  	command = commandSelection.value
		  	document.getElementById("movementCommandSelection").innerHTML = "You selected: " + commandSelection.options[commandSelection.selectedIndex].text;
		}
	</script>
</html>