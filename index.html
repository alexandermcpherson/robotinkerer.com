
<!DOCTYPE html>
<html>
	<head>
		<title>T800-Controller</title>
	</head>
	<body>
		<label for="movement-commands">Choose Movement command:</label><br>
		<select id="movement-commands" name="movement-commands" onchange="getMovementCommand()">
			<option value="activate" selected="selected">Activate T800</option>
			<option value="deactivate">Deactivate T800</option>
			<option value="randomHeadlr">Random Head left to right</option>
			<option value="randomHeadud">Random Head up and down</option>
			<option value="randomHeadfr">Random Head full range</option>				
		  	<option value="epic_mode_1">T1 Epic Mode</option>
		  	<option value="epic_mode_2">T2 Epic Mode</option>
		</select>
		<br>
		<p id="commandSelection">You selected: Activate T800</p>
		<br>
		<button id="discoverBluetoothBtn">Discover T800 Device</button>
	</body>
	<script>

		const bluetoothName = 'DSD TECH';
		const bluetoothUUIDservice = '0000ffe0-0000-1000-8000-00805f9b34fb';
		const bluetoothUUIDcharacteristic = '0000ffe1-0000-1000-8000-00805f9b34fb';

		var command = "";	
		
		document.getElementById("discoverBluetoothBtn").addEventListener('click', function() {
		  	navigator.bluetooth.requestDevice({
			    filters: [{
				    name: bluetoothName,
				    services: [bluetoothUUIDservice]
				  }]
			  	})
			  	.then(device => {
			    	console.log('> Requested ' + device.name + ' (' + device.id + ')');
				    // Attempts to connect to remote GATT Server.
		  			return device.gatt.connect();
			  	})
			  	.then(server => {
				  	return server.getPrimaryService(bluetoothUUIDservice);
				})
				.then(service => {
				  	return service.getCharacteristic(bluetoothUUIDcharacteristic);
				})
			  	.then(characteristic => {
					// const epicMode1 = "epic_mode_1";
					var stringArray = str2ab(command);
					return characteristic.writeValueWithoutResponse(stringArray);
				})
			  .catch(error => {
			    console.log('Argh! ' + error);
		  });
		});

		function getMovementCommand() {
			const commandSelection = document.getElementById("movement-commands")
		  	command = commandSelection.value

		  document.getElementById("commandSelection").innerHTML = "You selected: " + commandSelection.options[commandSelection.selectedIndex].text;
		}

		function str2ab(str) {
		  var buf = new ArrayBuffer(str.length*2); // 2 bytes for each char
		  var bufView = new Uint8Array(buf);
		  for (var i=0, strLen=str.length; i < strLen; i++) {
		    bufView[i] = str.charCodeAt(i);
		  }
		  return buf;
		}
	</script>
</html>